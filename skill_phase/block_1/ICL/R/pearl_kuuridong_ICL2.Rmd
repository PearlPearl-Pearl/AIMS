---
title: "Marketing Data Analysis"
author: "Pearl Nibebadaar Sandoh Kuuridong"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, error = TRUE)
```


## Instructions
```{r message=FALSE, warning=FALSE}
# Do not modify this chunk
library(tidyverse)
library(readxl) # package that will help you to load MS Excel data in R.
library(flextable)
library(ggplot2) # will help with advanced plotting if necessary.
```

In this assignment, we perform basic data exploration and visualization on marketing data. This is to get insights on how customers behave to what `FreshDirect` company offers. FreshDirect is the leader in online grocery delivery. Their marketing data captures customer information such as demographics, transaction behavior, and ordering patterns to enable loyalty analysis, segmentation, and predictive modeling.

Your task is to load the data using the package `readxl` allowing you to load excel files. Identify the function from the package with specific chosen parameters from it to get rid of some big issues that may come with data importing. Then you also need to perform some data cleaning for some computations.


Below is the data description.

```{r echo=FALSE}
# Do not modify this chunk
set_flextable_defaults(fonts_ignore=TRUE)
read_excel("FD_Marketing_Data_Dictionary.xlsx") %>%
  flextable() %>% autofit() %>%
  width(j = 1:2, width = c(2.2, 4)) %>% theme_box()
```

Use R to attempt each of the following questions. We recommend you to write your interpretation in your English.

## Part 1.

1. After importing data in R. Check which column has the highest count of missing information.
```{r}
# Import data in a variable named df
df <- read_xlsx("FD_data.xlsx", skip=1, na = c("NA", "N/A", "", "#N/A", "-", " "))

null_counts <- colSums(is.na(df))
null_counts[null_counts == max(null_counts)]

# Check the dimension of df
dim(df)
# Display the data structure of df
str(df)
```

**Point out any issue with the data (asterix serve as bullet points in markdown. Add * as much as possible.)**

* Some columns have a high number of missing values
* The amounts are being read in as character data types instead of numeric
* Date values are being read in as characters
* The loyalty_segment column is preceeded by a number.

2. How many unique customers are in the dataset?
```{r}
nrow(unique(df))
```

**Interpretation:**

* There are `r nrow(unique(df))` unique customers in the dataset


3. What is the age distribution of customers?
```{r}
df$AGE <- as.numeric(df$AGE)
age_summary <- summary(df$AGE, na.rm=T)
standard_dv <- sd(df$AGE, na.rm=T)

age_summary; standard_dv
```

**Interpretation:**

There are `r nrow(df)-543` non-null age values in the dataset. The minimum age is 0, and the maximum age is 101. The median age is 44 years, while the Mean age is 45.26 years. This slight difference between the median and mean ages suggests an outlier towards the higher side of the age range. The interquartile range is `r 101-36` and the standard deviation is `r 17.03842`

4. What is the income distribution (mean, median, spread or standard deviation)?
```{r}
df$cleaned_income <- as.numeric(gsub("\\$|,|\\(|\\)", "", df$INCOME), na.rm=T)

mean_income <- mean(df$cleaned_income, na.rm=T)
median_income <- median(df$cleaned_income, na.rm=T)
income_std <- sd(df$cleaned_income, na.rm=T)

mean_income; median_income; income_std
```

**Interpretation:**

The mean income is $`r mean_income` and the median income is `r median_income`. These values are within one standard deviation (`r income_std`) of each other and so, I claim the data is symmetric about the mean. 

5. After decoding the variable GENDER (replace F and M by Female and Male respectively), what are the count of male and female customers in the dataset?
```{r}
df$cleaned_gender <- df$GENDER
df$cleaned_gender[df$cleaned_gender=="F"] <- "Female"
df$cleaned_gender[df$cleaned_gender=="M"] <- "Male"

table(df$cleaned_gender)
```

**Interpretation:**

There are `r 1596` females in the dataset and `r 745` males in the dataset.


6. Which part of America has the highest customer counts?
```{r}
cust_counts <- table(df$GEOGRAPHY)
cust_counts[cust_counts==max(cust_counts)]
```

**Interpretation:**

`r names(cust_counts[cust_counts==max(cust_counts)])` has the highest customer counts in America.

7. How many customers fall into each LOYALTY_SEGMENT category? You can draw a pie/bar chart and interpret it.
```{r}
df$cleaned_loyalty <- gsub("\\d+\\.\\s+", "", df$LOYALTY_SEGMENT)
loyalty_counts = sort(table(df$cleaned_loyalty))
loyalty_counts; barplot(loyalty_counts)
```


**Interpretation:**

* 90 day shoppers and No segment shoppers form the smallest group of customers with 1 and 4 members in each respective category. Bi-weekly shoppers are the most frequent with 826 customers, followed by every 3 week shoppers with 783 counts. Weekly shoppers, infrequent shoppers, and once a month shoppers each have 631, 413, and 342 customers respectively.

8. Compute the average number of orders per customer in 12 months.
```{r}
# df$`12 Mo. Orders`
mean_orders = mean(df$`12 Mo. Orders`, na.rm=T)

mean_orders

```


**Interpretation:**

The average number of orders per customer, taking each row as one customer is `r mean_orders`

9. Compute the average sales per customer in 12 months?
```{r}
df$cleaned_twelve_sales <- as.numeric(gsub("\\$|,", "", df$`12 Mo. Sales`))
mean_sales = mean(df$cleaned_twelve_sales, na.rm=T)

mean_sales
```


**Interpretation:**

The average sales per customer in 12 months is about $`r round(mean_sales, 2)`

10. How many customers used DeliveryPass at least once?
```{r}
used_delivery_pass <- sum(df$`24 Mo. DELIVERYPASS_USED`>0)

used_delivery_pass
```

**Interpretation:**

`r used_delivery_pass` customers used DeliveryPass at least once

## Part 2.

11. Do higher-income customers place more orders?
```{r}
df$income_brackets <- df$cleaned_income



df$income_brackets[df$cleaned_income<=median_income] <- "LOW INCOME"
df$income_brackets[df$cleaned_income>median_income & df$cleaned_income<=mean_income] <- "MIDDLE INCOME"
df$income_brackets[df$cleaned_income>mean_income] <- "HIGH INCOME"

low_income_orders <- sum(df$`24 Mo. Orders`[df$income_brackets=="LOW INCOME"], na.rm=T)
middle_income_orders <- sum(df$`24 Mo. Orders`[df$income_brackets=="MIDDLE INCOME"], na.rm=T)
high_income_orders <- sum(df$`24 Mo. Orders`[df$income_brackets=="HIGH INCOME"], na.rm=T)

low_income_orders; middle_income_orders; high_income_orders
```

**Interpretation:**

No. Higher income customers place `r high_income_orders` orders and lower income customers place `r low_income_orders` orders. There are no middle income customers. This suggests that there is a gap in the income data as shown below:
```{r}
hist(df$cleaned_income)
```


12. Based on gender, is there any difference between average sales?
```{r}
df$cleaned_twenty_sales <- as.numeric(gsub("\\$|,", "", df$`24 Mo. Sales`))
total_twenty_sales <- sum(df$cleaned_twenty_sales)
female_sales <- sum(df$cleaned_twenty_sales[df$cleaned_gender=="Female"], na.rm=T)
male_sales <- sum(df$cleaned_twenty_sales[df$cleaned_gender=="Male"], na.rm=T)

avg_female_sales <- female_sales/total_twenty_sales
avg_male_sales <- male_sales/total_twenty_sales
```

**Interpretation:**

Females average about `r avg_female_sales` sales and the males average about `r avg_male_sales` sales. So yes, there is a difference in average sales based on gender.

13. How do `LOYALTY_SEGMENTS` differ in terms of twelve month sales?
```{r}
total_sales <- sum(df$cleaned_twelve_sales, na.rm=T)

bi_weekly_sum <- sum(df$cleaned_twenty_sales[df$cleaned_loyalty=="Bi-Weekly Shoppers"], na.rm=T)
infrequent_sum <- sum(df$cleaned_twenty_sales[df$cleaned_loyalty=="Infrequent Shoppers"], na.rm=T)
three_week_sum <- sum(df$cleaned_twenty_sales[df$cleaned_loyalty=="Every Three Week Shoppers"], na.rm=T)
monthly_sum <- sum(df$cleaned_twenty_sales[df$cleaned_loyalty=="Once a Month Shoppers"], na.rm=T)
weekly_sum <- sum(df$cleaned_twenty_sales[df$cleaned_loyalty=="Weekly Shoppers"], na.rm=T)
no_segment_sum <- sum(df$cleaned_twenty_sales[df$cleaned_loyalty=="No Segment"], na.rm=T)
new_shopper_sum <- sum(df$cleaned_twenty_sales[df$cleaned_loyalty=="90 Day New Shoppers"], na.rm=T)

bi_weekly_avg <- bi_weekly_sum/total_sales
infrequent_avg <- infrequent_sum/total_sales
three_week_avg <- three_week_sum/total_sales
monthly_avg <- monthly_sum/total_sales
weekly_avg <- weekly_sum/total_sales
no_segment_avg <- no_segment_sum/total_sales
new_shopper_avg <- new_shopper_sum/total_sales



pie(c(bi_weekly_avg, infrequent_avg, three_week_avg, monthly_avg, weekly_avg, no_segment_avg, new_shopper_avg), labels=c("Bi-Weekly","Infrequent", "Three_Week", "Monthly", "Weekly", "No Segment", "New Shopper"))

```


**Interpretation:**

Weekly segment is the one with the highest mean of 12 month sales. The new shopper and no_segment groups are very small, indicating that in 12 months the average amount of sales from new shoppers and customers without any segments is very low. This indicates a moderate to high customer loyalty. 

14. Do younger customers, for customer aged less than 30, use promos more than older ones?
```{r}
young_customers_promo = df[df$AGE<30,]$`24 Mo. Orders w. Promo`
total_young_promo <- sum(young_customers_promo, na.rm=T)
old_customers_promo = df[df$AGE>=30,]$`24 Mo. Orders w. Promo`
total_old_promo <- sum(old_customers_promo, na.rm=T)

total_young_promo; total_old_promo
```

**Interpretation:**

No younger customers used about $`r total_young_promo` in promos and older customers used about $`r total_old_promo` in promos

15. How does discount amount vary across income brackets?
```{r}
df$cleaned_twenty_discount_amount <- as.numeric(gsub("\\$","",df$`24 Mo. DISCOUNT_AMOUNT`), na.rm=T)

high_income_discount <- sum(df$cleaned_twenty_discount_amount[df$income_brackets=="HIGH INCOME"], na.rm=T)
middle_income_discount <- sum(df$cleaned_twenty_discount_amount[df$income_brackets=="MIDDLE INCOME"], na.rm=T)
low_income_discount <- sum(df$cleaned_twenty_discount_amount[df$income_brackets=="LOW INCOME"], na.rm=T)

high_income_discount; middle_income_discount; low_income_discount
```


**Interpretation:**

Higher earners used less in discounts `r high_income_discount` while lower earners used more in discounts `r low_income_discount`



16. Is DeliveryPass usage associated with higher total sales?
```{r}
plot(x = df$`24 Mo. DELIVERYPASS_USED`, y = df$cleaned_twenty_sales)
correlation <- cor(df$`24 Mo. DELIVERYPASS_USED`, df$cleaned_twenty_sales, method = "pearson")
```


**Interpretation:**

The scatter plot shows a roughly positive linear relationship between the number of times delivery pass was used and the total_sales. This is further confirmed by the correlation coefficient of `r correlation` which indicates a positive linear correlation.


17. Do frequent shoppers (Weekly, Bi-Weekly) pay less in delivery fees?
```{r}
df$cleaned_delivery <- as.numeric(gsub("\\$|,","",as.character(df$`24 Mo. DELIVERY_FEE_PAID`)))
frequent_shoppers <- df[df$cleaned_loyalty=="Weekly Shoppers"|df$cleaned_loyalty=="Bi-Weekly Shoppers",]
infrequent_shoppers <- df[!(df$cleaned_loyalty=="Weekly Shoppers"|df$cleaned_loyalty=="Bi-Weekly Shoppers"),]

total_delivery = sum(df$cleaned_delivery, na.rm=T)

frequent_deliv_mean <- mean(frequent_shoppers$cleaned_delivery, na.rm=T)
infrequent_deliv_mean <- mean(infrequent_shoppers$cleaned_delivery, na.rm=T)

frequent_deliv_median <- median(frequent_shoppers$cleaned_delivery, na.rm=T)
infrequent_deliv_median <- median(infrequent_shoppers$cleaned_delivery, na.rm=T)

hist(frequent_shoppers$cleaned_delivery)
hist(infrequent_shoppers$cleaned_delivery)

frequent_deliv_mean; infrequent_deliv_mean
frequent_deliv_median; infrequent_deliv_median
```

**Interpretation:**

Since the data is skewed to the right, then the median is a better descriptor of the data. We see that frequent shoppers paid an average of `r frequent_deliv_median` in delivery whereas the infrequent shoppers paid an average of `r infrequent_deliv_median` in delivery fees. 
We see that Frequent shoppers account for a greater percentage of the total delivery sales. So frequent shoppers pay more in delivery fees.


18. What percentage of total sales comes from each LOYALTY_SEGMENT?
```{r}
twenty_total_sales = sum(df$cleaned_twenty_sales, na.rm=T)

bi_weekly_percent = (bi_weekly_sum/twenty_total_sales)*100
infrequent_percent = (infrequent_sum/twenty_total_sales)*100
three_week_percent = (three_week_sum/twenty_total_sales)*100
monthly_percent = (monthly_sum/twenty_total_sales)*100
weekly_percent = (weekly_sum/twenty_total_sales)*100
no_segment_percent = (no_segment_sum/twenty_total_sales)*100
new_shopper_percent = (new_shopper_sum/twenty_total_sales)*100

bi_weekly_percent; infrequent_percent; three_week_percent; monthly_percent; weekly_percent; no_segment_percent; new_shopper_percent
```

**Interpretation:**

The percentage of total sales for each loyalty segment is given as `r bi_weekly_percent`,  `r infrequent_percent`, `r three_week_percent`, `r monthly_percent`, `r weekly_percent`, `r no_segment_percent`, `r new_shopper_percent` for bi_weekly_shoppers; infrequent_shoppers; three_week_shoppers; monthly_shoppers; weekly_shoppers; no_segment_shoppers; new_shopper_shoppers respectively

19. Are customers with earlier acquisition dates (older customers) more loyal in terms of orders?
```{r}
# View(df)

```

**Interpretation:**

20. Which ZIP codes have the highest per-customer spending?
```{r}
df$ZIP_CODE <- as.character(df$ZIP_CODE)

df %>%
  group_by(df$ZIP_CODE) %>%
  summarise(
    average = mean(cleaned_twenty_sales, na.rm = TRUE),
    n_customers = n()
  ) %>%
  arrange(desc(average))

```

**Interpretation:**

This zip code of 10465 has the highest per customer spending

## Part 3.
What is the day of the week with the highest average orders?
```{r}
sunday_orders <- df$`SUNDAY ORDERS 12 MO.`
monday_orders <- df$`MONDAY ORDERS 12 MO.`
tuesday_orders <- df$`TUESDAY ORDERS 12 MO.`
wednesday_orders <- df$`WEDNESDAY ORDERS 12 MO.`
thursday_orders <- df$`THURSDAY ORDERS 12 MO.`
friday_orders <- df$`FRIDAY ORDERS 12 MO.`
saturday_orders <- df$`SATURDAY ORDERS 12 MO.`


sunday_mean <- mean(sunday_orders, na.rm=T)
monday_mean <- mean(monday_orders, na.rm=T)
tuesday_mean <- mean(tuesday_orders, na.rm=T)
wednesday_mean <- mean(wednesday_orders, na.rm=T)
thursday_mean <- mean(thursday_orders, na.rm=T)
friday_mean <- mean(friday_orders, na.rm=T)
saturday_mean <- mean(saturday_orders, na.rm=T)

day_mean <- c(sunday=sunday_mean, monday=monday_mean, tuesday=tuesday_mean, wednesday=wednesday_mean, thursday=thursday_mean, friday=friday_mean, saturday=saturday_mean 
)

sort(day_mean, decreasing=T)
```

**Interpretation:**

Sunday is the day with the highest average order.

21. Is weekend ordering (Sat+Sun) higher than weekday ordering?
```{r}
weekend <- sum(df[c("SUNDAY ORDERS 12 MO.", "SATURDAY ORDERS 12 MO.")], na.rm=T)
weekday <- sum(df[c("MONDAY ORDERS 12 MO.", "TUESDAY ORDERS 12 MO.", "WEDNESDAY ORDERS 12 MO.", "THURSDAY ORDERS 12 MO.", "FRIDAY ORDERS 12 MO.")], na.rm=T)


weekend > weekday
```

**Interpretation:**

Weekend ordering `r weekend` is less than weekday ordering `r weekday`

22. Do different LOYALTY_SEGMENTS prefer different days of the week?
```{r}
weekend_df <- df[c("cleaned_loyalty","SUNDAY ORDERS 12 MO.", "SATURDAY ORDERS 12 MO.", "MONDAY ORDERS 12 MO.", "TUESDAY ORDERS 12 MO.", "WEDNESDAY ORDERS 12 MO.", "THURSDAY ORDERS 12 MO.", "FRIDAY ORDERS 12 MO.")]

weekend_df %>% group_by(weekend_df$cleaned_loyalty) %>% summarise(sunday    = mean(`SUNDAY ORDERS 12 MO.`, na.rm = TRUE),
    monday    = mean(`MONDAY ORDERS 12 MO.`, na.rm = TRUE),
    tuesday   = mean(`TUESDAY ORDERS 12 MO.`, na.rm = TRUE),
    wednesday = mean(`WEDNESDAY ORDERS 12 MO.`, na.rm = TRUE),
    thursday  = mean(`THURSDAY ORDERS 12 MO.`, na.rm = TRUE),
    friday    = mean(`FRIDAY ORDERS 12 MO.`, na.rm = TRUE),
    saturday  = mean(`SATURDAY ORDERS 12 MO.`, na.rm = TRUE))
```

**Interpretation:**

Yes. For instance 90 day shoppers prefer wednesday and friday over the other days of the week. While bi-weekly shoppers prefer sunday over the other days of the week.

23. Do promo orders cluster on specific days (e.g., Fridays)?
```{r}
```

**Interpretation:**

24. Are sales more evenly distributed across days or skewed to a few?

```{r}

```

**Interpretation:**

24. (Bonus) Draw at least 2 graphics and carefully interpret results.

```{r}
daily_sales <- rowSums(weekend_df[,-1], na.rm=T)
hist(daily_sales)
```
**Interpretation**

This histogram gives us an idea of the distribution of total weekly orders per customer. The horizontal axis represents the amount a customer spends per week while the vertical axis tells us about the number of people in each spending bracket. The histogram reveals that the data is skewed to the right, this means that more customers are spending less money per week on sales. We also see the presence of some outlier around the 150 mark which could probably be due to data entry errors, but regardless of the cause of the outlier, we know that it would significantly affect the mean of the dataset, and pull it towards the higher side of the scale. Thus the mean is not a good representation of the central point of the dataset.
```{r}
hist(df$AGE)
```

**Interpretation:**

For the age variable, we see that there is a single outlier at the 0 mark, which could be due to a data entry error since it does not make sense for a customer at an online retail shop to be 0 years old. The data seems slightly skewed to the right which is represented in the values of the mean and median. mean is `r mean(df$AGE, na.rm=T)` and median is `r median(df$AGE, na.rm=T)`. The standard deviation is `r sd(df$AGE, na.rm=T)`. Since the mean and median are within 1 standard deviation of each other, we can claim that this variable is roughly symmetric.

24. (Bonus) Perform at least one statistical test and interpret results.

```{r}

```

**Interpretation:**

## Submission
Submit the `.Rmd` and the knitted PDF files using the correct naming.